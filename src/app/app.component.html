<div class="dashboard">
  <h1>Аналитика в реальном времени</h1>

  <div class="chart-card">
    <h2>Продажи по месяцам</h2>
    <label>
      Количество месяцев:
      <input type="range" min="3" max="12" [(ngModel)]="monthRange" (change)="applyFilters()" />
      <strong>{{ monthRange }}</strong>
    </label>
    <ngx-charts-line-chart
      [view]="[1000, 400]"
      [scheme]="'cool'"
      [results]="salesData"
      [animations]="true"
      [autoScale]="true"
      [xAxis]="true"
      [yAxis]="true"
      [showXAxisLabel]="true"
      [showYAxisLabel]="true"
      xAxisLabel="Месяцы"
      yAxisLabel="Выручка"
      [legend]="true"
      [timeline]="true"
      [yAxisTickFormatting]="formatCurrency"
      [xAxisTickFormatting]="formatMonth">
    </ngx-charts-line-chart>
    <button (click)="toggleLiveData()">
      {{ liveDataEnabled ? 'Остановить' : 'Запустить' }}
    </button>
  </div>

  <div class="chart-card">
    <h2>Доля продуктов</h2>
    <label>
      Фильтр продукта:
      <select [(ngModel)]="selectedProduct" (change)="applyFilters()">
        <option value="Все">Все</option>
        <option *ngFor="let p of ['Смартфоны','Ноутбуки','Планшеты']" [value]="p">{{ p }}</option>
      </select>
    </label>
    <ngx-charts-pie-chart
      [view]="[500, 400]"
      [results]="productShare"
      [labels]="true"
      [doughnut]="true">
    </ngx-charts-pie-chart>
    <button (click)="randomizePieData()">Случайные данные</button>
  </div>

  <div class="chart-card">
    <h2>Продажи по регионам</h2>
    <div class="filters">
      <label *ngFor="let region of ['Москва','СПб','Казань']">
        <input type="checkbox" [(ngModel)]="regionFilters[region]" (change)="applyFilters()" />
        {{ region }}
      </label>
    </div>
    <ngx-charts-bar-vertical
      [view]="[800, 400]"
      [results]="regionData"
      [showDataLabel]="true"
      (select)="onRegionSelect($event)">
    </ngx-charts-bar-vertical>

    <div *ngIf="selectedRegionDetails" class="details">
      {{ selectedRegionDetails.name }} — {{ selectedRegionDetails.value }}
    </div>
  </div>

  <div class="chart-card">
    <h2>Эффективность рекламы</h2>
    <ngx-charts-bubble-chart
      [view]="[800,400]"
      [results]="bubbleData"
      [xAxis]="true"
      [yAxis]="true"
      [showXAxisLabel]="true"
      [showYAxisLabel]="true"
      xAxisLabel="Бюджет (₽)"
      yAxisLabel="Конверсия (%)"
      [minRadius]="10"
      [maxRadius]="50"
      [legend]="true"
      [autoScale]="true"
      [xAxisTickFormatting]="formatMoney"
      [yAxisTickFormatting]="formatPercent">
    </ngx-charts-bubble-chart>
  </div>

  <div class="chart-card">
    <h2>Динамика по направлениям</h2>
    <ngx-charts-area-chart-stacked
      [view]="[800, 400]"
      [results]="areaChartData"
      [xAxis]="true"
      [yAxis]="true"
      [showXAxisLabel]="true"
      [showYAxisLabel]="true"
      xAxisLabel="Месяц"
      [yAxisLabel]="areaMode === 'percent' ? 'Доля (%)' : 'Доход (₽)'"
      [legend]="true"
      [animations]="true"
      [yAxisTickFormatting]="areaMode === 'percent' ? formatPercent : formatMoney">
    </ngx-charts-area-chart-stacked>
    <button (click)="toggleAreaMode()">
      {{ areaMode === 'absolute' ? 'Показать %' : 'Показать значения' }}
    </button>
  </div>

  <div class="chart-card">
    <h2>KPI Выполнение</h2>
    <ngx-charts-gauge
      [view]="[400,260]"
      [results]="gaugeData"
      [max]="100"
      [min]="0">
    </ngx-charts-gauge>
    <button (click)="randomizeGauge()">Случайный KPI</button>
  </div>

  <div class="chart-card">
    <h2>Активность по времени (по дням)</h2>
    <ngx-charts-bar-vertical-2d
      [view]="[800, 400]"
      [results]="activityData"
      [xAxis]="true"
      [yAxis]="true"
      [showDataLabel]="true"
      [legend]="true">
    </ngx-charts-bar-vertical-2d>
  </div>

  <div class="chart-card">
    <h2>ТОП продуктов</h2>
    <ngx-charts-bar-horizontal
      [view]="[700,350]"
      [results]="topProducts"
      [gradient]="true"
      [showDataLabel]="true">
    </ngx-charts-bar-horizontal>
  </div>

  <div class="chart-card">
    <h2>Активность по дням и времени</h2>

    <ngx-charts-heat-map
      [view]="[700,350]"
      [results]="heatmapData"
      [scheme]="'vivid'"
      [xAxis]="true"
      [yAxis]="true"
      [showXAxisLabel]="true"
      [showYAxisLabel]="true"
      xAxisLabel="Время суток"
      yAxisLabel="День недели"
      [animations]="true">
    </ngx-charts-heat-map>
  </div>
</div>
